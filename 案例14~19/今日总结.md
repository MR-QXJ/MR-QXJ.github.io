## 今日总结

### 页面进度

在**每个部分后**加一个**script标签**，**定时器检查**内容的进度，进度**结束要删除相关的所有代码**，节省空间：

```
if(percent === 100){
    var pLen = proMove.length; /*只有在这里定义所有proMove才能获取完全*/
    //删除进度条相关所有代码,腾出空间
    body.removeChild(proBox); /*删除进度条html代码*/
    css.parentNode.removeChild(css); /*;删除相关css样式*/
    for(var i = pLen - 1; i >=  0; i--){ /*删除所有进度条js代码,这里必须从后往前删除，否则会有顺序错乱等bug*/
        body.removeChild(proMove[i]);
    }
```

### 省市县三级联动

点击依次的选项生成下一级的数据

由于**option**元素**不能用点击事件**判断被选中，可以给对应option的**父表单元素**添加**change**事件，**表单发生改变**时执行，并用原生js的**selectedIndex**属性获取**选中**的是**第几个(从1开始)**。每次生成数据需要清除之前的数据

### 图片延迟加载

当**页面滚动**到对应图片的**位置**时才给图片赋予原本的地址并**显示**，为了节省空间将图片元素**保存在数组**，**每次加载**元素后在**数组中删除**对应的元素，并且**循环从后往前**，可**跳过已加载**的图片且**减少循环次数**

```
for(var i = imgArr.length - 1; i >= 0; i--){   /*从后往前并在数组中删除已加载的图片可跳过已加载的并节省空间*/
    var imgTop = imgArr[i].offsetTop;
    if(imgTop < scrollTop + windH){
        imgArr[i].src = imgArr[i].srcArr;
        imgArr.splice(i,1); /*每次加载删除数组中的此图片，下次滚动减少检索次数*/
        console.log(imgArr); /*可观察到未加载的元素*/
    }
}
```

##### jq懒加载

```
/*使用此插件图片地址要写在data-original这个属性里*/
<img data-original="img/1.jpg" alt="" width="500" height="330" />
```

```
var $imgs = $("img");
$imgs.lazyload({
    effect: "slideDown",   /* 加载效果，slideDown，show，fadeIn*/
    placeholder: "img/loading.jpg"   /*未加载时展示的图片的地址*/
    //event: "事件"   指定事件触发才加载
    //container: "容器"   可规定容器内的图片进行懒加载
    //failurelimit: num  默认如果找到第一张不再可视区的图片时不再继续，传num数字可指定几张可视区外的图片停止
});
```

### 全屏滚动和模块淡入

主要根据点击和滚轮事件**判断索引的变化**，并使**页面滚动**到对应位置，使用transition淡入模块，注意在动画过程中阻止下一次滚动效果，并且**淡入**动画必须在页面**滚动动作完成后**，否则看不到

```
var $bg = $("#wrap>div");
function move(i) {
    $body.stop().animate({
        "scrollTop": i * winH + "px"
    },500,function () {
        toggle = true;
        $bg.eq(i).find(".pic").addClass("on");  /*必须在滚动动画结束后添加，否则看不到效果*/
        $bg.eq(i).siblings().find(".pic").removeClass("on");
    });
    $slideLi.eq(i).addClass("on").siblings().removeClass("on");
}
```
**jq**中跨**层级获取元素**更严格，可能会出现**问题**：

```
var pic = $(".pic");
pic.eq(i).addClass("on").removeClass("on");
```

**最好**是通过**父元素获取**：

```
var $bg = $("#wrap>div");
$bg.eq(i).find(".pic").addClass("on");  /*必须在滚动动画结束后添加，否则看不到效果*/
$bg.eq(i).siblings().find(".pic").removeClass("on");
```



